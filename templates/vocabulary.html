{% extends "base.html" %}
{% block title %}Wortschatz â€” German Prep{% endblock %}

{% block content %}
<div x-data="vocabApp()" class="max-w-3xl mx-auto space-y-6 animate-slide-up">

    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-display font-bold text-white">ğŸ“ Wortschatz (Vocabulary)</h1>
            <p class="text-slate-400 text-sm mt-1">135 B1 words organized by exam topics â€” flip cards to test yourself</p>
        </div>
        <a href="/api/vocab/export" class="bg-purple-500/20 text-purple-400 border border-purple-500/30 px-4 py-2 rounded-xl text-sm font-medium hover:bg-purple-500/30 transition-colors">
            ğŸ“¥ Export for Anki
        </a>
    </div>

    <!-- Category Selector -->
    <div class="flex flex-wrap gap-2">
        <button @click="selectCategory('all')"
                :class="selectedCategory === 'all' ? 'bg-brand-500/20 border-brand-500 text-brand-400' : 'bg-slate-800 border-slate-700 text-slate-400'"
                class="px-3 py-1.5 rounded-lg border text-sm transition-all hover:border-brand-500/50">
            All ({{ data.categories | sum(attribute='words', start=[]) | length }})
        </button>
        {% for cat in data.categories %}
        <button @click="selectCategory('{{ cat.name_en }}')"
                :class="selectedCategory === '{{ cat.name_en }}' ? 'bg-brand-500/20 border-brand-500 text-brand-400' : 'bg-slate-800 border-slate-700 text-slate-400'"
                class="px-3 py-1.5 rounded-lg border text-sm transition-all hover:border-brand-500/50">
            {{ cat.emoji }} {{ cat.name }} ({{ cat.words | length }})
        </button>
        {% endfor %}
    </div>

    <!-- Flashcard -->
    <div class="card-glow rounded-2xl p-8 text-center min-h-[280px] flex flex-col items-center justify-center cursor-pointer select-none"
         @click="flipCard()"
         :class="isFlipped ? 'border-emerald-500/30' : ''">

        <!-- Progress -->
        <div class="absolute top-4 left-4 text-xs text-slate-500">
            <span x-text="currentIndex + 1"></span> / <span x-text="filteredWords.length"></span>
        </div>

        <!-- Front (German) -->
        <div x-show="!isFlipped" x-transition class="space-y-3">
            <p class="text-3xl font-display font-bold text-white" x-text="currentWord.de"></p>
            <p class="text-slate-500 text-sm">Click to reveal translation</p>
        </div>

        <!-- Back (English + Example) -->
        <div x-show="isFlipped" x-transition class="space-y-4">
            <p class="text-3xl font-display font-bold text-emerald-400" x-text="currentWord.en"></p>
            <div class="bg-slate-800/50 rounded-xl px-4 py-3 max-w-md">
                <p class="text-sm text-slate-300 italic" x-text="currentWord.ex"></p>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="flex items-center justify-center gap-4">
        <button @click="prevWord()"
                class="bg-slate-800 border border-slate-700 text-slate-400 px-5 py-2.5 rounded-xl hover:bg-slate-700 hover:text-white transition-all">
            â† ZurÃ¼ck
        </button>

        <div class="flex gap-2">
            <button @click="markWord('hard')"
                    class="bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-2.5 rounded-xl hover:bg-red-500/20 transition-all text-sm font-medium">
                âŒ Hard
            </button>
            <button @click="markWord('ok')"
                    class="bg-brand-500/10 border border-brand-500/20 text-brand-400 px-4 py-2.5 rounded-xl hover:bg-brand-500/20 transition-all text-sm font-medium">
                ğŸ¤” OK
            </button>
            <button @click="markWord('easy')"
                    class="bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 px-4 py-2.5 rounded-xl hover:bg-emerald-500/20 transition-all text-sm font-medium">
                âœ… Easy
            </button>
        </div>

        <button @click="nextWord()"
                class="bg-brand-500 text-slate-900 font-bold px-5 py-2.5 rounded-xl hover:bg-brand-400 transition-all">
            Weiter â†’
        </button>
    </div>

    <!-- Stats -->
    <div class="card-glow rounded-2xl p-4">
        <div class="flex items-center justify-between text-sm">
            <div class="flex gap-4">
                <span class="text-red-400">âŒ Hard: <span class="font-bold" x-text="stats.hard"></span></span>
                <span class="text-brand-400">ğŸ¤” OK: <span class="font-bold" x-text="stats.ok"></span></span>
                <span class="text-emerald-400">âœ… Easy: <span class="font-bold" x-text="stats.easy"></span></span>
            </div>
            <button @click="shuffleWords()" class="text-slate-500 hover:text-slate-300 text-xs">ğŸ”€ Shuffle</button>
        </div>
    </div>

    <!-- Word List (collapsible) -->
    <div x-data="{ open: false }" class="card-glow rounded-2xl overflow-hidden">
        <button @click="open = !open" class="w-full p-4 text-left flex items-center justify-between hover:bg-slate-800/50 transition-colors">
            <h3 class="font-display font-bold text-brand-400">ğŸ“‹ Full Word List</h3>
            <span class="text-slate-500 text-xl" x-text="open ? 'âˆ’' : '+'"></span>
        </button>
        <div x-show="open" x-transition class="px-4 pb-4">
            <div class="max-h-96 overflow-y-auto space-y-1">
                <template x-for="word in filteredWords" :key="word.de">
                    <div class="flex items-center justify-between py-1.5 border-b border-slate-800/50 text-sm">
                        <span class="text-slate-300 font-medium" x-text="word.de"></span>
                        <span class="text-slate-500" x-text="word.en"></span>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function vocabApp() {
    const allCategories = {{ data.categories | tojson }};
    let allWords = [];
    allCategories.forEach(cat => {
        cat.words.forEach(w => { w._category = cat.name_en; allWords.push(w); });
    });

    return {
        allWords: allWords,
        filteredWords: [...allWords],
        selectedCategory: 'all',
        currentIndex: 0,
        isFlipped: false,
        stats: { hard: 0, ok: 0, easy: 0 },

        get currentWord() {
            return this.filteredWords[this.currentIndex] || { de: 'â€”', en: 'â€”', ex: 'â€”' };
        },

        init() { this.shuffleWords(); },

        selectCategory(cat) {
            this.selectedCategory = cat;
            if (cat === 'all') {
                this.filteredWords = [...this.allWords];
            } else {
                this.filteredWords = this.allWords.filter(w => w._category === cat);
            }
            this.currentIndex = 0;
            this.isFlipped = false;
            this.shuffleWords();
        },

        flipCard() { this.isFlipped = !this.isFlipped; },

        nextWord() {
            this.currentIndex = (this.currentIndex + 1) % this.filteredWords.length;
            this.isFlipped = false;
        },

        prevWord() {
            this.currentIndex = this.currentIndex > 0 ? this.currentIndex - 1 : this.filteredWords.length - 1;
            this.isFlipped = false;
        },

        markWord(level) {
            this.stats[level]++;
            this.nextWord();
        },

        shuffleWords() {
            this.filteredWords.sort(() => Math.random() - 0.5);
            this.currentIndex = 0;
            this.isFlipped = false;
        },
    };
}
</script>
{% endblock %}
